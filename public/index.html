<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Odyss√©e - Assistant Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@200;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg-1: #0f172a; --bg-2: #1e293b; 
            --accent: #38bdf8; /* Bleu Cyan √©lectrique pour le c√¥t√© Tech/Pro */
            --text-main: #f8fafc;
        }
        
        body { 
            font-family: 'Outfit', sans-serif; 
            background: radial-gradient(circle at top, #1e293b, #020617);
            color: var(--text-main);
            height: 100vh; overflow: hidden; margin: 0; touch-action: none;
        }

        /* UI GLASSPHORISM */
        .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.5);
        }

        /* BOUTON MICRO CENTRAL */
        .mic-container {
            position: relative;
            width: 90px; height: 90px;
            display: flex; align-items: center; justify-content: center;
        }
        
        .mic-btn {
            width: 70px; height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, #0ea5e9, #2563eb);
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 20px rgba(14, 165, 233, 0.4);
            transition: all 0.2s;
            cursor: pointer; z-index: 50; position: relative;
        }
        .mic-btn:active { transform: scale(0.95); }
        
        /* RIPPLE EFFECT */
        .ripple { position: absolute; border-radius: 50%; border: 1px solid var(--accent); opacity: 0; pointer-events: none; }
        .listening .ripple { animation: rippleAnim 2s infinite; }
        .listening .ripple:nth-child(2) { animation-delay: 0.5s; }
        @keyframes rippleAnim { 0% { width: 70px; height: 70px; opacity: 0.8; } 100% { width: 140px; height: 140px; opacity: 0; } }

        /* TEXTE STATUS */
        .status-text { text-transform: uppercase; letter-spacing: 2px; font-size: 10px; color: #94a3b8; margin-top: 15px; }

        /* NAV BAR */
        .nav-bar {
            width: 100%; padding: 15px 20px; padding-bottom: 30px;
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;
        }
        .nav-item { 
            display: flex; flex-direction: column; align-items: center; gap: 6px; 
            opacity: 0.4; transition: 0.3s; background: transparent; border: none; cursor: pointer;
        }
        .nav-item.active { opacity: 1; transform: translateY(-5px); }
        .nav-item.active svg { fill: var(--accent); drop-shadow(0 0 10px var(--accent)); }
        .nav-item svg { width: 22px; height: 22px; fill: white; }
        .nav-label { font-size: 9px; font-weight: 600; text-transform: uppercase; color: white; letter-spacing: 0.5px; }

        /* MODE DISPLAY */
        .mode-display {
            text-align: center; margin-top: 40px;
        }
        .mode-icon-lg { font-size: 40px; margin-bottom: 10px; filter: drop-shadow(0 0 20px rgba(56, 189, 248, 0.3)); }
        .mode-title { font-size: 32px; font-weight: 200; letter-spacing: -1px; background: linear-gradient(to right, #fff, #94a3b8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .mode-desc { font-size: 13px; color: #64748b; max-width: 250px; margin: 0 auto; line-height: 1.4; }

    </style>
</head>
<body class="flex flex-col justify-between">

    <div class="mode-display flex-1 flex flex-col justify-center">
        <div id="mode-icon" class="mode-icon-lg">üíº</div>
        <h1 id="mode-title" class="mode-title">R√©dacteur</h1>
        <p id="mode-desc" class="mode-desc">Emails, courriers, posts LinkedIn, correction et reformulation.</p>
        
        <div id="visualizer" class="h-12 flex items-center justify-center gap-1 mt-8 opacity-0 transition-opacity duration-500">
            <div class="w-1 h-3 bg-sky-400 rounded-full animate-pulse"></div>
            <div class="w-1 h-6 bg-sky-400 rounded-full animate-pulse delay-75"></div>
            <div class="w-1 h-4 bg-sky-400 rounded-full animate-pulse delay-150"></div>
            <div class="w-1 h-6 bg-sky-400 rounded-full animate-pulse delay-100"></div>
            <div class="w-1 h-3 bg-sky-400 rounded-full animate-pulse delay-200"></div>
        </div>
    </div>

    <div class="glass-panel rounded-t-3xl">
        
        <div class="flex flex-col items-center -mt-10">
            <div id="mic-container" class="mic-container">
                <div class="ripple"></div><div class="ripple"></div>
                <div id="btn-mic" class="mic-btn">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="white"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>
                </div>
            </div>
            <p id="status" class="status-text">Appuyez pour parler</p>
        </div>

        <div class="nav-bar">
            <button class="nav-item active" onclick="switchMode('REDACTEUR', this)">
                <svg viewBox="0 0 24 24"><path d="M2.5 19h19v2h-19zm19.57-9.36c-.21-.8-1.04-1.28-1.84-1.06L14.92 10l-6.9-6.43-1.93.51 4.14 7.17-4.97 1.33-1.97-1.54-1.45.39 1.82 3.16.77 1.33 1.6-.43 5.31-1.42 4.35-1.16c.8-.21 1.28-1.05 1.07-1.85z"/></svg>
                <span class="nav-label">R√©dacteur</span>
            </button>
            
            <button class="nav-item" onclick="switchMode('SOLVEUR', this)">
                <svg viewBox="0 0 24 24"><path d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"/></svg>
                <span class="nav-label">Solveur</span>
            </button>
            
            <button class="nav-item" onclick="switchMode('STRATEGE', this)">
                <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM6 19V5h12v14H6zm6-6h-2v2h2v-2zm0-4h-2v2h2V9z"/></svg>
                <span class="nav-label">Strat√®ge</span>
            </button>

            <button class="nav-item" onclick="switchMode('MENTOR', this)">
                <svg viewBox="0 0 24 24"><path d="M12 3L1 9l4 2.18v6L12 21l7-3.82v-6l2-1.09V17h2V9L12 3zm6.82 6L12 12.72 5.18 9 12 5.28 18.82 9zM17 15.99l-5 2.73-5-2.73v-3.72l5 2.73 5-2.73v3.72z"/></svg>
                <span class="nav-label">Mentor</span>
            </button>
        </div>
    </div>

    <script>
        // ==========================================
        // CONFIGURATION (VOTRE URL VERCEL)
        // ==========================================
        const API_BASE_URL = "https://boite-adulte.vercel.app/";
        // ==========================================

        let currentMode = 'REDACTEUR';
        let isProcessing = false;
        let currentAudio = null;

        const MODES = {
            'REDACTEUR': {
                title: "R√©dacteur Pro",
                desc: "R√©daction d'emails, correction, lettres officielles, posts r√©seaux sociaux.",
                icon: "üíº",
                prompt: "Tu es un expert en communication et un assistant ex√©cutif de haut niveau. Ta t√¢che est de r√©diger, corriger ou reformuler des textes. L'utilisateur te donnera un contexte. Produis un r√©sultat professionnel, clair et percutant. Si c'est un email, inclus l'objet. Ne sois pas bavard, donne le r√©sultat."
            },
            'SOLVEUR': {
                title: "Solveur Technique",
                desc: "Bricolage, cuisine, calculs, bugs informatiques. Solutions pas √† pas.",
                icon: "üîß",
                prompt: "Tu es un ing√©nieur polyvalent et un expert en r√©solution de probl√®mes (bricolage, cuisine, tech). L'utilisateur a un probl√®me concret. Donne une solution structur√©e, √©tape par √©tape (Step 1, Step 2...). Sois pr√©cis, s√©curitaire et pratique."
            },
            'STRATEGE': {
                title: "Strat√®ge",
                desc: "Prise de d√©cision, n√©gociation, analyse de situation, pour et contre.",
                icon: "‚ôüÔ∏è",
                prompt: "Tu es un consultant en strat√©gie et un n√©gociateur expert. L'utilisateur doit prendre une d√©cision ou pr√©parer une n√©gociation. Analyse la situation, donne les Pour et les Contre, identifie les angles morts et propose un plan d'action rationnel."
            },
            'MENTOR': {
                title: "Mentor Savoir",
                desc: "Explications simples, traductions, r√©sum√©s de concepts complexes.",
                icon: "üéì",
                prompt: "Tu es un professeur p√©dagogue et un traducteur expert. L'utilisateur veut apprendre ou comprendre quelque chose. Explique le concept simplement (vulgarisation) ou traduis le texte demand√©. Utilise des analogies si n√©cessaire pour la clart√©."
            }
        };

        function switchMode(modeKey, btn) {
            currentMode = modeKey;
            
            // UI Update
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            btn.classList.add('active');

            const info = MODES[modeKey];
            document.getElementById('mode-title').innerText = info.title;
            document.getElementById('mode-desc').innerText = info.desc;
            document.getElementById('mode-icon').innerText = info.icon;
            
            // Animation
            const title = document.getElementById('mode-title');
            title.style.opacity = 0;
            setTimeout(() => title.style.opacity = 1, 200);

            stopAudio();
            updateStatus("Pr√™t.");
        }

        const btnMic = document.getElementById('btn-mic');
        const micContainer = document.getElementById('mic-container');

        btnMic.addEventListener('click', () => {
            if (isProcessing) return;
            startListening();
        });

        function startListening() {
            if(currentAudio) stopAudio();

            const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!Speech) { alert("Micro non support√©."); return; }

            const rec = new Speech();
            rec.lang = 'fr-FR';
            rec.interimResults = false;

            rec.onstart = () => {
                micContainer.classList.add('listening');
                updateStatus("Je vous √©coute...");
            };

            rec.onend = () => {
                micContainer.classList.remove('listening');
            };

            rec.onresult = (event) => {
                const text = event.results[0][0].transcript;
                processRequest(text);
            };

            rec.start();
        }

        async function processRequest(text) {
            if(!text) return;
            isProcessing = true;
            updateStatus("Analyse...");
            document.getElementById('visualizer').style.opacity = 1;

            const modeInfo = MODES[currentMode];
            // Construction du Prompt Intelligent
            const finalPrompt = `${modeInfo.prompt} \n\n DEMANDE UTILISATEUR : "${text}"`;

            try {
                // 1. APPEL GEMINI
                const repIA = await fetch(`${API_BASE_URL}/api/gemini`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ prompt: finalPrompt })
                });
                const dataIA = await repIA.json();
                
                // 2. APPEL AZURE TTS
                updateStatus("G√©n√©ration vocale...");
                const repAudio = await fetch(`${API_BASE_URL}/api/azure`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ text: dataIA.text })
                });

                if (repAudio.ok) {
                    const blob = await repAudio.blob();
                    const url = URL.createObjectURL(blob);
                    currentAudio = new Audio(url);
                    updateStatus("Lecture...");
                    currentAudio.play();
                    currentAudio.onended = () => {
                        isProcessing = false;
                        updateStatus("Pr√™t.");
                        document.getElementById('visualizer').style.opacity = 0;
                    };
                } else {
                    // Fallback si Azure plante
                    const utt = new SpeechSynthesisUtterance(dataIA.text);
                    utt.lang = 'fr-FR';
                    window.speechSynthesis.speak(utt);
                    isProcessing = false;
                }

            } catch (e) {
                console.error(e);
                updateStatus("Erreur.");
                isProcessing = false;
                document.getElementById('visualizer').style.opacity = 0;
            }
        }

        function stopAudio() {
            if (currentAudio) { currentAudio.pause(); currentAudio = null; }
            window.speechSynthesis.cancel();
            document.getElementById('visualizer').style.opacity = 0;
        }

        function updateStatus(text) {
            document.getElementById('status').innerText = text;
        }
    </script>
</body>
</html>